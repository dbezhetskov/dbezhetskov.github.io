<html>

<head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="utf-8" http-equiv="encoding">
</head>

<body>
    <input type="file" id="input-wasm" />
    <script src="robot-battle.js"></script>
    <script src="canvas-render.js"></script>
    <script>
        const inputElement = document.getElementById("input-wasm");
        inputElement.addEventListener("change", handleFile, false);
        function handleFile() {
            const wasmFile = this.files[0];
            const wasmURL = window.URL.createObjectURL(wasmFile);
            initializeWasm(wasmURL).then(main);
        }

        async function initializeWasm(wasmURL) {
            const fetchPromise = fetch(wasmURL);
            const imports = {
                wasi_snapshot_preview1: {
                    proc_exit: console.log(),
                    fd_write: console.log(),
                    clock_time_get: console.log(),
                    clock_res_get: console.log(),
                    fd_filestat_get: console.log(),
                    fd_readdir: console.log(),
                    fd_close: console.log(),
                    fd_write: console.log(),
                    fd_seek: console.log(),
                    fd_read: console.log(),
                    fd_fdstat_get: console.log(),
                    path_open: console.log(),
                    path_unlink_file: console.log(),
                    path_remove_directory: console.log(),
                    environ_sizes_get: console.log(),
                    environ_get: console.log(),
                    args_sizes_get: console.log(),
                    args_get: console.log(),
                    fd_prestat_get: console.log(),
                    fd_prestat_dir_name: console.log(),
                    fd_fdstat_set_flags: console.log()
                }
            };
            const { instance } = await WebAssembly.instantiateStreaming(fetchPromise, imports);
            return instance;
        }

        function main(instance) {
            console.log(instance.exports.memory);
        }
    </script>
</body>

</html>